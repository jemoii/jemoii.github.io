<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Redis数据类型（二） · Jemoii's Blog</title><meta name="description" content="Redis数据类型（二） - Jemoii"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://g.hijkl.mn/atom.xml" title="Jemoii's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/jemoii" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Redis数据类型（二）</h1><div class="post-info">2015年5月4日</div><div class="post-content"><p>####Redis Lists</p>
<ul>
<li>Redis Lists是通过链表实现的，对于一个数据系统，能向较长表中快速添加元素至关重要；</li>
<li>通过lpush命令向表头添加元素的时间复杂度为O(1)；</li>
<li>通过rpush命令向表尾添加元素；</li>
<li>lrange命令列出两个参数（作为下标可以为负）之间的元素，时间复杂度为O(n)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; rpush llist A</div><div class="line">(integer) 1</div><div class="line">127.0.0.1:6379&gt; rpush llist B</div><div class="line">(integer) 2</div><div class="line">127.0.0.1:6379&gt; lpush llist first</div><div class="line">(integer) 3</div><div class="line">127.0.0.1:6379&gt; lrange llist 0 -1</div><div class="line">1) &quot;first&quot;#0、-3</div><div class="line">2) &quot;A&quot;	#1、-2</div><div class="line">3) &quot;B&quot;	#2、-1</div><div class="line">#可以使用rpush命令将多个元素一次性添加到表中</div><div class="line">127.0.0.1:6379&gt; rpush llist 1 2 &quot;hello, world&quot;</div><div class="line">(integer) 6</div><div class="line">&gt; lrange llist 0 -1</div><div class="line">1) &quot;first&quot;</div><div class="line">2) &quot;A&quot;</div><div class="line">3) &quot;B&quot;</div><div class="line">4) &quot;1&quot;</div><div class="line">5) &quot;2&quot;</div><div class="line">6) &quot;hello, world&quot;</div></pre></td></tr></table></figure>
<ul>
<li>类似的可以使用lpop、rpop分别从表头、表尾检索并删除元素</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; rpop llist</div><div class="line">&quot;hello, world&quot;</div><div class="line">127.0.0.1:6379&gt; lpop llist</div><div class="line">&quot;first&quot;</div></pre></td></tr></table></figure>
<ul>
<li>对空表执行rpop、lpop将返回(nil)；</li>
<li><strong>redis lists可以用于分享页面的实现，新的分享生成后，将其ID通过rpush命令添加到表中，使用lrange命令在页面列出一定数量的分享</strong>；</li>
<li>ltrim命令保留两个参数之间的元素，删除其余元素</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; rpush llist 3 4</div><div class="line">(integer) 6</div><div class="line">127.0.0.1:6379&gt; ltrim llist 2 -1</div><div class="line">OK</div><div class="line">127.0.0.1:6379&gt; lrange llist 0 -1</div><div class="line">1) &quot;1&quot;</div><div class="line">2) &quot;2&quot;</div><div class="line">3) &quot;3&quot;</div><div class="line">4) &quot;4&quot;</div></pre></td></tr></table></figure>
<ul>
<li>为了避免队列实现中，队列为空时，需要反复执行rpop、lpop命令带来的不良后果，redis lists提供了brpop、blpop命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; brpop llist 5</div><div class="line">1) &quot;llist&quot;</div><div class="line">2) &quot;4&quot;</div><div class="line">#等待执行删除命令，5秒后如果表仍为空，返回</div></pre></td></tr></table></figure>
<p>####Redis Hashes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; hmset user:0 username voler country China</div><div class="line">OK</div><div class="line">127.0.0.1:6379&gt; hget user:0 username</div><div class="line">&quot;voler&quot;</div><div class="line">127.0.0.1:6379&gt; hgetall user:0</div><div class="line">1) &quot;username&quot;</div><div class="line">2) &quot;voler&quot;</div><div class="line">3) &quot;country&quot;</div><div class="line">4) &quot;China&quot;</div><div class="line">#hmset、hget命令类似于set、get</div></pre></td></tr></table></figure>
<p>####Redis Sets</p>
<ul>
<li>Redis Sets是字符串的无序集合；</li>
<li>使用sismember命令检查参数是否为集合中的元素</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; sadd sset 1 2 3</div><div class="line">(integer) 3</div><div class="line">127.0.0.1:6379&gt; smembers sset</div><div class="line">1) &quot;1&quot;</div><div class="line">2) &quot;2&quot;</div><div class="line">3) &quot;3&quot;</div><div class="line">127.0.0.1:6379&gt; sismember sset 3</div><div class="line">(integer) 1</div><div class="line">127.0.0.1:6379&gt; sismember sset 0</div><div class="line">(integer) 0</div></pre></td></tr></table></figure>
<ul>
<li><strong>redis sets可以用于标签的实现，为每个需要贴标签的实体关联一个sets，sets中保存标签的ID</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; sadd blog:1:tags 2 5</div><div class="line">(integer) 2</div><div class="line">#为第1篇博文贴上2号、5号标签</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; sadd tag:2:blog 1</div><div class="line">(integer) 1</div><div class="line">127.0.0.1:6379&gt; sadd tag:5:blog 1</div><div class="line">(integer) 1</div><div class="line">#为第1篇博文贴上2号、5号标签</div></pre></td></tr></table></figure>
<ul>
<li>获取为第1篇博文贴上的标签</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; smembers blog:1:tags</div><div class="line">1) &quot;2&quot;</div><div class="line">2) &quot;5&quot;</div></pre></td></tr></table></figure>
<p>####Redis Sorted sets</p>
<ul>
<li>Redis Sorted sets可以看做Sets与Hashes的组合；</li>
<li>sorted set中的每个元素与一个浮点数score相关联，与hash类似；</li>
<li>将hackers的name作为sorted set的元素，birth作为score</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; zadd hackers 1940 Tom</div><div class="line">(integer) 1</div><div class="line">127.0.0.1:6379&gt; zadd hackers 1957 John</div><div class="line">(integer 1)</div><div class="line">127.0.0.1:6379&gt; zadd hackers 1953 Tim</div><div class="line">(integer) 1</div></pre></td></tr></table></figure>
<ul>
<li>返回一个根据score已经完成排序的集合</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">127.0.0.1:6379&gt; zrange hackers 0 -1</div><div class="line">1) &quot;Tom&quot;</div><div class="line">2) &quot;Tim&quot;</div><div class="line">3) &quot;John&quot;</div><div class="line">#按照相反的规则排序</div><div class="line">127.0.0.1:6379&gt; zrevrange hackers 0 -1</div><div class="line">1) &quot;John&quot;</div><div class="line">2) &quot;Tim&quot;</div><div class="line">3) &quot;Tom&quot;</div><div class="line">#使用--withscores同时返回score</div><div class="line">127.0.0.1:6379&gt; zrange hackers 0 -1 withscores</div><div class="line">1) &quot;Tom&quot;</div><div class="line">2) &quot;1940&quot;</div><div class="line">3) &quot;Tim&quot;</div><div class="line">4) &quot;1953&quot;</div><div class="line">5) &quot;John&quot;</div><div class="line">6) &quot;1957&quot;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#使用zrangebyscore命令返回score位于两个参数之间的元素</div><div class="line">#-inf表示负无穷</div><div class="line">127.0.0.1:6379&gt; zrangebyscore hackers -inf 1953</div><div class="line">1) &quot;Tom&quot;</div><div class="line">2) &quot;Tim&quot;</div><div class="line">#使用zremrangebyscore命令删除score位于两个参数之间的元素，并返回被删元素的个数</div><div class="line">127.0.0.1:6379&gt; zremrangebyscore hackers 1953 1955</div><div class="line">(integer) 1</div><div class="line">#使用zrank命令返回参数在集合中的序号</div><div class="line">127.0.0.1:6379&gt; zrank hackers John</div><div class="line">(integer) 1</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#元素的score完全相等时，元素按字典序排序</div><div class="line">127.0.0.1:6379&gt; zadd hackers 0 V 0 O 0 L 0 L 0 E 0 R</div><div class="line">(integer) 5</div><div class="line">127.0.0.1:6379&gt; zrange hackers 0 -1</div><div class="line">1) &quot;E&quot;</div><div class="line">2) &quot;L&quot;</div><div class="line">3) &quot;O&quot;</div><div class="line">4) &quot;R&quot;</div><div class="line">5) &quot;V&quot;</div><div class="line">127.0.0.1:6379&gt; zrangebylex hackers [H [O</div><div class="line">1) &quot;L&quot;</div><div class="line">2) &quot;O&quot;</div></pre></td></tr></table></figure>
<ul>
<li><strong>redis sorted sets可以用于积分榜的实现，每次执行zadd命令，集合会被更新，时间复杂度为log(n)，使用zrank命令返回元素当前排名</strong><br>```</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/redis-client-for-java/" class="prev">上一篇</a><a href="/redis-strings/" class="next">下一篇</a></div><div class="copyright"><p>© 2014 - 2017 <a href="https://g.hijkl.mn">Jemoii</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>