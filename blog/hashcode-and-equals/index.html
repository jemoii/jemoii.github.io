<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Java中的hashCode()和equals() · Jemoii's Blog</title><meta name="description" content="Java中的hashCode()和equals() - Jemoii"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://g.hijkl.mn/atom.xml" title="Jemoii's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/jemoii" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Java中的hashCode()和equals()</h1><div class="post-info">2014年11月10日</div><div class="post-content"><h4 id="什么是hashCode"><a href="#什么是hashCode" class="headerlink" title="什么是hashCode()"></a>什么是hashCode()</h4><p>HashCode()是java.lang.Object中定义的一种方法，用于返回一个散列值。在Java语言中，所有的类都要提供一个HashCode()方法。散列值被用来将对象分类，以实现快速存储和检索。默认情况下，每个类继承实现java.lang.Object提供的HashCode()，但是这对于特殊的用户可能不会是高效或者精确的，因此，很多类覆盖了这个方法。</p>
<h4 id="The-Contract"><a href="#The-Contract" class="headerlink" title="The Contract"></a>The Contract</h4><p>Java语言中提供了两个有关联的方法hashCode()和equals()。如果两个对象使用equals()返回true，那么使用hashCode()也会返回相同的散列值。但是，当两个对象使用equals()返回false，使用hashCode()不一定会返回不同的散列值。<code>需要记住的是，如果两个对象使用equals()返回true，那么使用hashCode()方法会返回相同的散列值。当你覆盖equals()方法时，要同时覆盖hashCode()方法。Always override hashCode and equals together！</code></p>
<h4 id="一个相关的例子-源代码-："><a href="#一个相关的例子-源代码-：" class="headerlink" title="一个相关的例子(源代码)："></a>一个相关的例子<a href="http://www.programcreek.com/2011/07/java-equals-and-hashcode-contract/" target="_blank" rel="external">(源代码)</a>：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> String color;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">(String color)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.color = color;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (!(obj <span class="keyword">instanceof</span> Apple))</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		<span class="keyword">if</span> (obj == <span class="keyword">this</span>)</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.color.equals(((Apple) obj).color);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		Apple a1 = <span class="keyword">new</span> Apple(<span class="string">"green"</span>);</div><div class="line">		Apple a2 = <span class="keyword">new</span> Apple(<span class="string">"red"</span>);</div><div class="line"></div><div class="line">		<span class="comment">//HashMap中存储苹果类型及其数量</span></div><div class="line">		HashMap&lt;Apple, Integer&gt; m = <span class="keyword">new</span> HashMap&lt;Apple, Integer&gt;();</div><div class="line"></div><div class="line">		m.put(a1, <span class="number">10</span>);</div><div class="line">		m.put(a2, <span class="number">20</span>);</div><div class="line">		System.out.println(m.get(<span class="keyword">new</span> Apple(<span class="string">"green"</span>)));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时运行程序的结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">null</div></pre></td></tr></table></figure>
<p>同时覆盖<code>hashCode()</code>，即添加代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这里仅以此为例</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.color.length();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时运行程序的结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">10</div></pre></td></tr></table></figure>
<h4 id="怎么覆盖hashCode"><a href="#怎么覆盖hashCode" class="headerlink" title="怎么覆盖hashCode()"></a>怎么覆盖hashCode()</h4><p>如果要实现存储对象的集合的存储和检索效率最大化，需要提供一个完美的散列函数。实现散列函数的基本目标是，提供散列值的统一分配。统一分配意味着，N个可能的返回结果具有相同的返回概率1/N。很难在实际中提供一个完美的散列函数。</p>
<h5 id="实现散列函数的方法"><a href="#实现散列函数的方法" class="headerlink" title="实现散列函数的方法"></a>实现散列函数的方法</h5><ul>
<li>Apache Commons包有一个<a href="http://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/builder/HashCodeBuilder.html" target="_blank" rel="external">HashCodeBuilder</a>可以用来提供hashCode()的实现：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Class Employee &#123;</div><div class="line"></div><div class="line">	String name;</div><div class="line">	<span class="keyword">int</span> empId;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">		<span class="comment">//5和7是随机选择的两个数</span></div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> HashCodeBuilder(<span class="number">5</span>, <span class="number">7</span>). append(name).append(empId).toHashCode();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>使用IDE（集成开发环境）提供的典型实现方法：</li>
</ul>
<p>例如，在Eclipse中，<code>right click on class &gt;&gt; source &gt; Generate hashCode() and equals() …</code></p>
<ul>
<li>Apache Commons包中的<a href="http://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/builder/EqualsBuilder.html" target="_blank" rel="external">EqualsBuilder</a>可以用来提供equals()的实现。</li>
</ul>
<h4 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h4><p><a href="http://javahash.com/java-hashcode-and-equals-most-important-things-to-consider/" target="_blank" rel="external">Java Hashcode and equals – Most Important Things to Consider</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/blog/no-parameter-constructor/" class="prev">上一篇</a><a href="/blog/the-explanation-for-hashmap/" class="next">下一篇</a></div><div class="copyright"><p>© 2014 - 2017 <a href="https://g.hijkl.mn">Jemoii</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>