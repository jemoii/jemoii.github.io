<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Pattern Matching · Jemoii's Blog</title><meta name="description" content="Pattern Matching - Jemoii"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://g.hijkl.mn/atom.xml" title="Jemoii's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/jemoii" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Pattern Matching</h1><div class="post-info">2014年12月21日</div><div class="post-content"><h4 id="Pattern-Matching"><a href="#Pattern-Matching" class="headerlink" title="Pattern Matching"></a>Pattern Matching</h4><p>MySQL提供了标准的SQL模式匹配,和以Unix中正则表达式为基础的模式匹配.</p>
<p>SQL模式匹配允许你使用<code>_</code>来匹配任意单个字符,使用<code>%</code>来匹配任意数量的字符(包括零个字符).在MySQL中,SQL模式匹配默认情况下对大小写不敏感.下面是一些例子.在SQL模匹配式中,不是使用<code>=</code>,<code>&lt;&gt;</code>,而是使用<code>LIKE,NOT LIKE</code>.</p>
<p>为了找到以<code>b</code>开头的<code>name</code>值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &apos;b%&apos;;</div><div class="line">+--------+--------+---------+------+------------+------------+</div><div class="line">| name   | owner  | species | sex  | birth      | death      |</div><div class="line">+--------+--------+---------+------+------------+------------+</div><div class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</div><div class="line">| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |</div><div class="line">+--------+--------+---------+------+------------+------------+</div></pre></td></tr></table></figure>
<p>找到以<code>fy</code>结尾的<code>name</code>值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &apos;%fy&apos;;</div><div class="line">+--------+--------+---------+------+------------+-------+</div><div class="line">| name   | owner  | species | sex  | birth      | death |</div><div class="line">+--------+--------+---------+------+------------+-------+</div><div class="line">| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |</div><div class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |</div><div class="line">+--------+--------+---------+------+------------+-------+</div></pre></td></tr></table></figure>
<p>找到包含<code>w</code>的<code>name</code>值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &apos;%w%&apos;;</div><div class="line">+----------+-------+---------+------+------------+------------+</div><div class="line">| name     | owner | species | sex  | birth      | death      |</div><div class="line">+----------+-------+---------+------+------------+------------+</div><div class="line">| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |</div><div class="line">| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |</div><div class="line">| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |</div><div class="line">+----------+-------+---------+------+------------+------------+</div></pre></td></tr></table></figure>
<p>找到<code>name</code>值为五个字符长度,使用五个<code>_</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name LIKE &apos;_____&apos;;</div><div class="line">+-------+--------+---------+------+------------+-------+</div><div class="line">| name  | owner  | species | sex  | birth      | death |</div><div class="line">+-------+--------+---------+------+------------+-------+</div><div class="line">| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |</div><div class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</div><div class="line">+-------+--------+---------+------+------------+-------+</div></pre></td></tr></table></figure>
<p>MySQL中其他类型的模式匹配是扩展的正则表达式,当你使用这种类型的模式匹配时,使用<code>REGEXP</code>和<code>NOT REGEXP</code>,或者<code>RLIKE</code>和<code>NOT RLIKE</code>,两者是等价的.</p>
<p>下面描述了扩展的正则表达式的特征:</p>
<ul>
<li><code>.</code>匹配任意单个字符;</li>
<li><code>[...]</code>匹配方括号内的任意字符,例如<code>&#39;[abc]&#39;</code>匹配<code>&#39;a&#39;</code>,<code>&#39;b&#39;</code>,<code>&#39;ab&#39;</code>和<code>&#39;c&#39;</code>.<code>&#39;[a-z]&#39;</code>匹配任意字母,<code>&#39;[0-9]&#39;</code>匹配任意数字;</li>
<li><code>*</code>匹配零个或多个它前面的实例,例如<code>&#39;x*&#39;</code>匹配任意多个<code>&#39;x&#39;</code>,<code>&#39;[0-9]*&#39;</code>匹配任意多个数字,<code>&#39;.*&#39;</code>匹配任意多个字符;</li>
<li>值中的任意部分匹配成功,<code>REGEXP</code>匹配成功,整个值匹配成功,<code>LIKE</code>才匹配成功;</li>
<li>在匹配开头使用<code>^</code>,来保证一定要匹配开头,在匹配末尾使用<code>$</code>,来保证一定要匹配末尾.</li>
</ul>
<p>为了演示扩展的正则表达式是如何工作的,使用<code>REGEXP</code>代替<code>LIKE</code>重写前面的例子:</p>
<p>为了找到以<code>b</code>开头的<code>name</code>值,使用<code>^</code>匹配<code>name</code>开头:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name REGEXP &apos;^b&apos;;</div><div class="line">+--------+--------+---------+------+------------+------------+</div><div class="line">| name   | owner  | species | sex  | birth      | death      |</div><div class="line">+--------+--------+---------+------+------------+------------+</div><div class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |</div><div class="line">| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |</div><div class="line">+--------+--------+---------+------+------------+------------+</div></pre></td></tr></table></figure>
<p>如果你想强制<code>REGEXP</code>匹配对大小写敏感,使用关键字<code>BINARY</code>,这个查询只匹配以小写的<code>b</code>开头的<code>name</code>值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name REGEXP BINARY &apos;^b&apos;;</div></pre></td></tr></table></figure>
<p>找到以<code>fy</code>结尾的<code>name</code>值,使用<code>$</code>来匹配<code>name</code>末尾:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name REGEXP &apos;fy$&apos;;</div><div class="line">+--------+--------+---------+------+------------+-------+</div><div class="line">| name   | owner  | species | sex  | birth      | death |</div><div class="line">+--------+--------+---------+------+------------+-------+</div><div class="line">| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |</div><div class="line">| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |</div><div class="line">+--------+--------+---------+------+------------+-------+</div></pre></td></tr></table></figure>
<p>找到包含<code>w</code>的<code>name</code>值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name REGEXP &apos;w&apos;;</div><div class="line">+----------+-------+---------+------+------------+------------+</div><div class="line">| name     | owner | species | sex  | birth      | death      |</div><div class="line">+----------+-------+---------+------+------------+------------+</div><div class="line">| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |</div><div class="line">| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |</div><div class="line">| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |</div><div class="line">+----------+-------+---------+------+------------+------------+</div></pre></td></tr></table></figure>
<p>因为正则表达式匹配在值的任意位置出现的<code>w</code>,所以不需要像使用SQL匹配那样,在其两侧放置通配符.</p>
<p>找到<code>name</code>值为五个字符长度,使用<code>^</code>匹配<code>name</code>开头,使用<code>$</code>来匹配<code>name</code>末尾:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name REGEXP &apos;^.....$&apos;;</div><div class="line">+-------+--------+---------+------+------------+-------+</div><div class="line">| name  | owner  | species | sex  | birth      | death |</div><div class="line">+-------+--------+---------+------+------------+-------+</div><div class="line">| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |</div><div class="line">| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |</div><div class="line">+-------+--------+---------+------+------------+-------+</div></pre></td></tr></table></figure>
<p>也可以使用<code>{n}</code>操作符这样写查询:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE name REGEXP ‘^.&#123;5&#125;$’;</div></pre></td></tr></table></figure>
<p>注意模式匹配是：使用关键字后面的字符匹配关键字前面的字符:</p>
<p>上面的查询若写为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT * FROM pet WHERE ‘^…..$’ REGEXP name;</div></pre></td></tr></table></figure>
<p>得不到任何查询结果.</p>
<h4 id="英文原文："><a href="#英文原文：" class="headerlink" title="英文原文："></a>英文原文：</h4><p><a href="http://dev.mysql.com/doc/refman/5.6/en/pattern-matching.html" target="_blank" rel="external">Pattern Matching</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/blog/sorting-counting-rows/" class="prev">上一篇</a><a href="/blog/working-with-null/" class="next">下一篇</a></div><div class="copyright"><p>© 2014 - 2017 <a href="https://g.hijkl.mn">Jemoii</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>