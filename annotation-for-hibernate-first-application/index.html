<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 对Hibernate文档的注释（一） · Jemoii's Blog</title><meta name="description" content="对Hibernate文档的注释（一） - Jemoii"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://g.hijkl.mn/atom.xml" title="Jemoii's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/jemoii" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">对Hibernate文档的注释（一）</h1><div class="post-info">2015年5月26日</div><div class="post-content"><p>本文是依照参考文档学习时的总结，参考文档原文：<a href="http://docs.jboss.org/hibernate/orm/4.3/manual/en-US/html/ch01.html#tutorial-firstapp" target="_blank" rel="external">1.1. Part 1 - The first Hibernate Application</a></p>
<p>#####The mapping file</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0"?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></div><div class="line"><span class="meta">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></div><div class="line"><span class="meta">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"me.hibernate.ex.domain"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- all persistent entity classes need a mapping to a table in the SQL database --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Event"</span> <span class="attr">table</span>=<span class="string">"EVENTS"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- mapping the unique identifier property to the tables primary key --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"EVENT_ID"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"date"</span> <span class="attr">type</span>=<span class="string">"timestamp"</span> <span class="attr">column</span>=<span class="string">"EVENT_DATE"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!-- without the column attribute, Hibernate by default uses the property name as the column name --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"title"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>映射文件<code>Event.hbm.xml</code>等同于<code>.sql</code>文件。</p>
<p>#####Hibernate configuration</p>
<p>文档中使用HSQLDB作为数据库，这里使用MySQL作为数据库，需要修改数据库连接设置，</p>
<pre><code class="xml">&lt;!-- Database connection settings --&gt;
&lt;property name="connection.driver_class"&gt;com.mysql.jdbc.Driver&lt;/property&gt;
&lt;property name="connection.url"&gt;jdbc:mysql://localhost/test&lt;/property&gt;

&lt;!-- SQL dialect --&gt;
&lt;property name="hibernate.dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;
</code></pre>

<p>同时添加依赖包<code>mysql-connector-java-bin.jar</code>。</p>
<p>#####Startup and helpers</p>
<p>文档中提供的代码与最新的<code>hibernate-core</code>不匹配，需要修改<code>buildSessionFactory()</code>方法中的try块为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">	<span class="comment">// Create the SessionFactory from hibernate.cfg.xml</span></div><div class="line">	Configuration configuration = <span class="keyword">new</span> Configuration();</div><div class="line">	configuration.configure();</div><div class="line">	ServiceRegistry serviceRegistry = <span class="keyword">new</span> StandardServiceRegistryBuilder().applySettings(configuration.getProperties()).build();</div><div class="line">	<span class="keyword">return</span> configuration.buildSessionFactory(serviceRegistry);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="http://www.journaldev.com/2897/solved-hibernateexception-access-to-dialectresolutioninfo-cannot-be-null-when-hibernate-dialect-not-set" target="_blank" rel="external">[Solved] HibernateException: Access to DialectResolutionInfo cannot be null when ‘hibernate.dialect’ not set</a>中给出了详细的说明。</p>
<p>#####Loading and storing objects</p>
<p>文档中提供的代码使用args参数，这里将main函数简化为，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"></div><div class="line">	Session session = HibernateUtil.getSessionFactory().getCurrentSession();</div><div class="line">	session.beginTransaction();</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		Event theEvent = <span class="keyword">new</span> Event();</div><div class="line">		theEvent.setTitle(<span class="string">"Event"</span>);</div><div class="line">		theEvent.setDate(<span class="keyword">new</span> Date());</div><div class="line">		session.save(theEvent);</div><div class="line"></div><div class="line">		session.getTransaction().commit();</div><div class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">		<span class="keyword">if</span> (session.beginTransaction() != <span class="keyword">null</span>)</div><div class="line">			session.beginTransaction().rollback();</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">		<span class="comment">//session.close();</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用<code>getCurrentSession()</code>开始Session，在事务结束后，Hibernate会自动释放Session，如果使用<code>session.close();</code>会提示错误，</p>
<blockquote>
<p>Session was already closed</p>
</blockquote>
<p>如果使用文档中提供的代码，可以参考<a href="http://www.cnblogs.com/2010Freeze/articles/2345989.html" target="_blank" rel="external">Eclipse里如何给main函数里的args参数赋值</a>。</p>
<p>现在运行<code>EventManager.java</code>可以看到，</p>
<blockquote>
<p>Hibernate: insert into EVENTS (EVENT_DATE, title) values (?, ?)</p>
</blockquote>
<p>查询本地MySQL数据库，</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">mysql&gt; use test;</div><div class="line">Database changed</div><div class="line">mysql&gt; show tables;</div><div class="line">+<span class="comment">----------------+</span></div><div class="line">| Tables_in_test |</div><div class="line">+<span class="comment">----------------+</span></div><div class="line">| events         |</div><div class="line">+<span class="comment">----------------+</span></div><div class="line"></div><div class="line">mysql&gt; describe events;</div><div class="line">+<span class="comment">------------+--------------+------+-----+---------+----------------+</span></div><div class="line">| Field      | Type         | Null | Key | Default | Extra          |</div><div class="line">+<span class="comment">------------+--------------+------+-----+---------+----------------+</span></div><div class="line">| EVENT_ID   | bigint(20)   | NO   | PRI | NULL    | auto_increment |</div><div class="line">| EVENT_DATE | datetime     | YES  |     | NULL    |                |</div><div class="line">| title      | varchar(255) | YES  |     | NULL    |                |</div><div class="line">+<span class="comment">------------+--------------+------+-----+---------+----------------+</span></div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure>
<p>#####Class Configuration &amp; Interface SessionFactory（4.3）</p>
<p>创建<code>SessionFactory</code>时，<code>Configuration</code>实例允许应用指定即将使用的性质和映射文件，默认情况下使用<code>hibernate.properties</code>指定的性质。SessionFactry`是不可变的，不受Configuration变化的影响。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Configuration <span class="title">configure</span><span class="params">()</span> <span class="keyword">throws</span> HibernateException</span>&#123;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 使用hibernate.cfg.xml指定的性质和映射关系</span></div></pre></td></tr></table></figure>
<p>应用一般创建单一的<code>Configuration</code>和<code>SessionFactory</code>实例，然后实例化多个会话线程服务客户端的请求。</p>
<p>#####Interface Session（4.3）</p>
<p><code>Session</code>是Java应用与Hibernate之间主要的运行时接口，<code>Session</code>的生命周期受到<code>逻辑事务</code>开始与结束的限制。<code>Session</code>的主要功能是对实体类的实例进行新建、读取和删除操作。</p>
<p>实例的三个阶段：</p>
<ol>
<li><em>transient</em>，未关联任何Session；</li>
<li><em>persistent</em>，与唯一Session关联；</li>
<li><em>detached</em>，位于<em>persistent</em>之后，未关联任何Session。</li>
</ol>
<p><img src="https://moetu.fastmirror.org/images/2017/09/20/hibernate_session0f225f6d3b608bb9.png" alt="实例的三个阶段"></p>
<p>Session抛出异常时，事务必须回滚。</p>
</div></article></div></main><footer><div class="paginator"><a href="/annotation-since-servlet3.0/" class="prev">上一篇</a><a href="/regular-expressions1-10/" class="next">下一篇</a></div><div class="copyright"><p>© 2014 - 2017 <a href="https://g.hijkl.mn">Jemoii</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>